<div class="container">
  <div class="header">
    <h1>Materyal Listesi</h1>
    <div class="search-section">
      <div class="search-box">
        <input 
          type="text" 
          [(ngModel)]="searchHisseKodu" 
          placeholder="Hisse kodu girin..."
          class="search-input"
          (keyup.enter)="onSearch()"
        >
        <button (click)="onSearch()" class="search-btn">
          <i class="search-icon">üîç</i>
          Ara
        </button>
        <button (click)="clearSearch()" class="clear-btn">
          Temizle
        </button>
        <button (click)="refreshData()" class="refresh-btn">
          <i class="refresh-icon">üîÑ</i>
          Yenile
        </button>
        <button (click)="addNewMaterial()" class="add-btn">
          <i class="add-icon">‚ûï</i>
          Yeni Kayƒ±t
        </button>
      </div>
    </div>
  </div>

  <!-- Otomatik Yenileme Bilgisi -->
  <div class="refresh-info">
    <div class="refresh-status">
      <span class="refresh-label">Son Yenileme:</span>
      <span class="refresh-time">{{ lastRefreshTime | date:'HH:mm:ss' }}</span>
    </div>
    <div class="countdown-section">
      <span class="countdown-label">Sonraki Yenileme:</span>
      <span class="countdown-timer" [class.warning]="countdown <= 10">
        {{ countdown }}s
      </span>
    </div>
  </div>

  <div class="error-message" *ngIf="error">
    {{ error }}
  </div>

  <div class="loading" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Materyal verileri y√ºkleniyor...</p>
  </div>

  <!-- üìä Tablo Alanƒ± -->
  <div class="table-container" *ngIf="!isLoading">
    <table class="material-table">
      <thead>
        <!-- Filtre satƒ±rƒ± -->
        <tr class="filter-row">
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.id" 
              (input)="applyFilters()"
              placeholder="ID filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.tarih" 
              (input)="applyFilters()"
              placeholder="Tarih filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.hisseKodu" 
              (input)="applyFilters()"
              placeholder="Hisse kodu filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.islem" 
              (input)="applyFilters()"
              placeholder="ƒ∞≈ülem filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.adet" 
              (input)="applyFilters()"
              placeholder="Adet filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.fiyat" 
              (input)="applyFilters()"
              placeholder="Fiyat filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.toplam" 
              (input)="applyFilters()"
              placeholder="Toplam filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.komisyon" 
              (input)="applyFilters()"
              placeholder="Komisyon filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.netTutar" 
              (input)="applyFilters()"
              placeholder="Net tutar filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.anlikFiyat" 
              (input)="applyFilters()"
              placeholder="Anlƒ±k fiyat filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.anlikTutar" 
              (input)="applyFilters()"
              placeholder="Anlƒ±k tutar filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.karZarar" 
              (input)="applyFilters()"
              placeholder="Kar/zarar filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.karZararYuzde" 
              (input)="applyFilters()"
              placeholder="Kar/zarar % filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.ortalamaMaliyet" 
              (input)="applyFilters()"
              placeholder="Ortalama maliyet filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <input 
              type="text" 
              [(ngModel)]="filters.aciklama" 
              (input)="applyFilters()"
              placeholder="A√ßƒ±klama filtrele..."
              class="filter-input"
            >
          </th>
          <th>
            <button (click)="clearAllFilters()" class="clear-filters-btn">
              üóëÔ∏è Temizle
            </button>
          </th>
        </tr>
        
        <!-- Header satƒ±rƒ± -->
        <tr>
          <th (click)="sortData('id')" title="ID'ye g√∂re sƒ±rala">
            ID
            <span *ngIf="sortColumn === 'id'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('tarih')" title="Tarihe g√∂re sƒ±rala">
            Tarih
            <span *ngIf="sortColumn === 'tarih'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('hisseKodu')" title="Hisse koduna g√∂re sƒ±rala">
            Hisse Kodu
            <span *ngIf="sortColumn === 'hisseKodu'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('islem')" title="ƒ∞≈üleme g√∂re sƒ±rala">
            ƒ∞≈ülem
            <span *ngIf="sortColumn === 'islem'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('adet')" title="Adete g√∂re sƒ±rala">
            Adet
            <span *ngIf="sortColumn === 'adet'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('fiyat')" title="Fiyata g√∂re sƒ±rala">
            Fiyat
            <span *ngIf="sortColumn === 'fiyat'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('toplam')" title="Toplama g√∂re sƒ±rala">
            Toplam
            <span *ngIf="sortColumn === 'toplam'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('komisyon')" title="Komisyona g√∂re sƒ±rala">
            Komisyon
            <span *ngIf="sortColumn === 'komisyon'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('netTutar')" title="Net tutara g√∂re sƒ±rala">
            Net Tutar
            <span *ngIf="sortColumn === 'netTutar'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('anlikFiyat')" title="Anlƒ±k fiyata g√∂re sƒ±rala">
            Anlƒ±k Fiyat
            <span *ngIf="sortColumn === 'anlikFiyat'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('anlikTutar')" title="Anlƒ±k tutara g√∂re sƒ±rala">
            Anlƒ±k Tutar
            <span *ngIf="sortColumn === 'anlikTutar'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('karZarar')" title="Kar/zarara g√∂re sƒ±rala">
            Kar/Zarar
            <span *ngIf="sortColumn === 'karZarar'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('karZararYuzde')" title="Kar/zarar y√ºzdesine g√∂re sƒ±rala">
            Kar/Zarar %
            <span *ngIf="sortColumn === 'karZararYuzde'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('ortalamaMaliyet')" title="Ortalama maliyete g√∂re sƒ±rala">
            Ortalama Maliyet
            <span *ngIf="sortColumn === 'ortalamaMaliyet'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortData('aciklama')" title="A√ßƒ±klamaya g√∂re sƒ±rala">
            A√ßƒ±klama
            <span *ngIf="sortColumn === 'aciklama'" class="sort-indicator">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th>ƒ∞≈ülemler</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let material of filteredMaterials" class="material-row">
          <td>{{ material.id }}</td>
          <td>{{ material.tarih | date:'dd.MM.yyyy' }}</td>
          <td>{{ material.hisseKodu }}</td>
          <td>{{ material.islem }}</td>
          <td>{{ material.adet | number:'1.2-2' }}</td>
          <td>{{ material.fiyat | number:'1.2-2' }}</td>
          <td>{{ material.toplam | number:'1.2-2' }}</td>
          <td>{{ material.komisyon | number:'1.2-2' }}</td>
          <td>{{ material.netTutar | number:'1.2-2' }}</td>
          <td>{{ material.anlikFiyat | number:'1.2-2' }}</td>
          <td>{{ material.anlikTutar | number:'1.2-2' }}</td>
          <td [class]="material.karZarar >= 0 ? 'profit' : 'loss'">
            {{ material.karZarar | number:'1.2-2' }}
          </td>
          <td [class]="material.karZararYuzde >= 0 ? 'profit' : 'loss'">
            {{ material.karZararYuzde | number:'1.2-2' }}%
          </td>
          <td>{{ material.ortalamaMaliyet | number:'1.2-2' }}</td>
          <td>{{ material.aciklama }}</td>
          <td>
            <button 
              (click)="updateMaterial(material)" 
              class="update-btn"
              title="G√ºncelle"
            >
              ‚úèÔ∏è
            </button>
            <button 
              (click)="deleteMaterial(material)" 
              class="delete-btn"
              title="Sil"
            >
              üóëÔ∏è
            </button>
          </td>
        </tr>
      </tbody>
      
      <!-- Toplam satƒ±rƒ± -->
      <tfoot>
        <tr class="total-row">
          <td class="total-label">TOPLAM</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td class="total-value">{{ getTotalAdet() | number:'1.2-2' }}</td>
          <td>-</td>
          <td class="total-value">{{ getTotalToplam() | number:'1.2-2' }}</td>
          <td class="total-value">{{ getTotalKomisyon() | number:'1.2-2' }}</td>
          <td class="total-value">{{ getTotalNetTutar() | number:'1.2-2' }}</td>
          <td>-</td>
          <td class="total-value">{{ getTotalAnlikTutar() | number:'1.2-2' }}</td>
          <td class="total-value" [class]="getTotalKarZarar() >= 0 ? 'profit' : 'loss'">
            {{ getTotalKarZarar() | number:'1.2-2' }}
          </td>
          <td class="total-value" [class]="getWeightedKarZararYuzde() >= 0 ? 'profit' : 'loss'">
            {{ getWeightedKarZararYuzde() | number:'1.2-2' }}%
          </td>
          <td class="total-value">{{ getWeightedOrtalamaMaliyet() | number:'1.2-2' }}</td>
          <td>-</td>
          <td>-</td>
        </tr>
      </tfoot>
    </table>

    <div class="no-data" *ngIf="filteredMaterials.length === 0 && !error">
      <p>G√∂sterilecek materyal bulunamadƒ±.</p>
    </div>
  </div>

  <div class="info-section">
    <p class="total-count">
      Toplam {{ filteredMaterials.length }} materyal g√∂steriliyor
    </p>
  </div>
</div>

